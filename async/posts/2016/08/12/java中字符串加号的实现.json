{"tags":[],"categories":[],"url":"/async/posts/2016/08/12/java中字符串加号的实现.json","date":1470983720000,"path":{"year":2016,"month":8,"day":12,"name":"java中字符串加号的实现"},"title":"","permalink":"http://yoursite.com/2016/08/12/java中字符串加号的实现/","content":"<p>title:”java中字符串加号的实现”<br>date:”2016-06-21”<br>categories:”java基础” </p>\n<h1 id=\"例子展示\"><a href=\"#例子展示\" class=\"headerlink\" title=\"例子展示\"></a>例子展示</h1><figure class=\"highlight arduino\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> Test&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> main(<span class=\"keyword\">String</span>[] args)&#123;</div><div class=\"line\">\t\tSystem.out.<span class=\"built_in\">println</span>(<span class=\"keyword\">new</span> <span class=\"keyword\">String</span>(<span class=\"string\">\"hello world\"</span>)+<span class=\"keyword\">new</span> <span class=\"keyword\">String</span>(<span class=\"string\">\"lp\"</span>));</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>输出结果hello world lp</p>\n<h1 id=\"实现原理\"><a href=\"#实现原理\" class=\"headerlink\" title=\"实现原理\"></a>实现原理</h1><p>java中的字符串的相加其实是编译器帮我们转化的，编译器会将字符串相加编译成使用StringBuilder拼接相加的字符串。<br>我们看下使用javap -verbose Test 得到的java字节码。</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">Code</span>:</div><div class=\"line\">      stack=<span class=\"number\">5</span>, locals=<span class=\"number\">1</span>, args_size=<span class=\"number\">1</span></div><div class=\"line\">         <span class=\"number\">0</span>: getstatic     <span class=\"meta\">#2                  <span class=\"comment\">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></div><div class=\"line\">         <span class=\"number\">3</span>: <span class=\"keyword\">new</span>           <span class=\"meta\">#3                  <span class=\"comment\">// class java/lang/StringBuilder</span></span></div><div class=\"line\">         <span class=\"number\">6</span>: dup</div><div class=\"line\">         <span class=\"number\">7</span>: invokespecial <span class=\"meta\">#4                  <span class=\"comment\">// Method java/lang/StringBuilder.\"&lt;init&gt;\":()V</span></span></div><div class=\"line\">        <span class=\"number\">10</span>: <span class=\"keyword\">new</span>           <span class=\"meta\">#5                  <span class=\"comment\">// class java/lang/String</span></span></div><div class=\"line\">        <span class=\"number\">13</span>: dup</div><div class=\"line\">        <span class=\"number\">14</span>: ldc           <span class=\"meta\">#6                  <span class=\"comment\">// String hello world</span></span></div><div class=\"line\">        <span class=\"number\">16</span>: invokespecial <span class=\"meta\">#7                  <span class=\"comment\">// Method java/lang/String.\"&lt;init&gt;\":(Ljava/lang/String;)V</span></span></div><div class=\"line\">        <span class=\"number\">19</span>: invokevirtual <span class=\"meta\">#8                  <span class=\"comment\">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span></div><div class=\"line\">        <span class=\"number\">22</span>: <span class=\"keyword\">new</span>           <span class=\"meta\">#5                  <span class=\"comment\">// class java/lang/String</span></span></div><div class=\"line\">        <span class=\"number\">25</span>: dup</div><div class=\"line\">        <span class=\"number\">26</span>: ldc           <span class=\"meta\">#9                  <span class=\"comment\">// String lp</span></span></div><div class=\"line\">        <span class=\"number\">28</span>: invokespecial <span class=\"meta\">#7                  <span class=\"comment\">// Method java/lang/String.\"&lt;init&gt;\":(Ljava/lang/String;)V</span></span></div><div class=\"line\">        <span class=\"number\">31</span>: invokevirtual <span class=\"meta\">#8                  <span class=\"comment\">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span></div><div class=\"line\">        <span class=\"number\">34</span>: invokevirtual <span class=\"meta\">#10                 <span class=\"comment\">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span></span></div><div class=\"line\">        <span class=\"number\">37</span>: invokevirtual <span class=\"meta\">#11                 <span class=\"comment\">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></div><div class=\"line\">        <span class=\"number\">40</span>: <span class=\"keyword\">return</span></div></pre></td></tr></table></figure>\n<p>我们看到34和37分别是使用了stringbuilder.append(“hello world”)和stringbuilder.append(“lp”)</p>\n"}